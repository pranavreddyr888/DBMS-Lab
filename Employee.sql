create database Employee1;
use Employee1;



CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(20),
    DLOC VARCHAR(20)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(20),
    MGR_NO INT,
    HIREDATE DATE,
    SAL INT,
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(20),
    PNAME VARCHAR(20)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(20),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT INT,
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);


INSERT INTO DEPT VALUES (10, 'HR', 'Bengaluru');
INSERT INTO DEPT VALUES (20, 'Finance', 'Hyderabad');
INSERT INTO DEPT VALUES (30, 'IT', 'Mysuru');
INSERT INTO DEPT VALUES (40, 'Admin', 'Chennai');
INSERT INTO DEPT VALUES (50, 'Marketing', 'Mumbai');


INSERT INTO EMPLOYEE VALUES (1001, 'Ravi', 1005, '2018-01-12', 45000, 10);
INSERT INTO EMPLOYEE VALUES (1002, 'Kiran', 1005, '2019-03-20', 52000, 20);
INSERT INTO EMPLOYEE VALUES (1003, 'Sneha', 1006, '2020-05-10', 48000, 30);
INSERT INTO EMPLOYEE VALUES (1004, 'Deepa', 1006, '2017-11-01', 60000, 40);
INSERT INTO EMPLOYEE VALUES (1005, 'Arun', NULL, '2015-07-14', 75000, 10);
INSERT INTO EMPLOYEE VALUES (1006, 'Ramesh', NULL, '2016-09-30', 80000, 30);


INSERT INTO PROJECT VALUES (501, 'Bengaluru', 'Payroll');
INSERT INTO PROJECT VALUES (502, 'Hyderabad', 'ERP');
INSERT INTO PROJECT VALUES (503, 'Mysuru', 'CRM');
INSERT INTO PROJECT VALUES (504, 'Chennai', 'HRMS');
INSERT INTO PROJECT VALUES (505, 'Mumbai', 'MarketingSuite');


INSERT INTO ASSIGNED_TO VALUES (1001, 501, 'Developer');
INSERT INTO ASSIGNED_TO VALUES (1002, 502, 'Analyst');
INSERT INTO ASSIGNED_TO VALUES (1003, 503, 'Tester');
INSERT INTO ASSIGNED_TO VALUES (1004, 504, 'Manager');
INSERT INTO ASSIGNED_TO VALUES (1005, 501, 'Lead');
INSERT INTO ASSIGNED_TO VALUES (1006, 503, 'Architect');


INSERT INTO INCENTIVES VALUES (1001, '2023-03-10', 5000);
INSERT INTO INCENTIVES VALUES (1002, '2023-03-15', 7000);
INSERT INTO INCENTIVES VALUES (1004, '2023-03-18', 4000);
INSERT INTO INCENTIVES VALUES (1005, '2023-03-22', 8000);

SELECT DISTINCT a.EMPNO
FROM ASSIGNED_TO a
JOIN PROJECT p ON a.PNO = p.PNO
WHERE p.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT e.EMPNO
FROM EMPLOYEE e
WHERE e.EMPNO NOT IN (
    SELECT EMPNO
    FROM INCENTIVES
);

SELECT e.ENAME, e.EMPNO, d.DNAME, a.JOB_ROLE, d.DLOC AS Dept_Location, p.PLOC AS Project_Location
FROM EMPLOYEE e
JOIN DEPT d ON e.DEPTNO = d.DEPTNO
JOIN ASSIGNED_TO a ON e.EMPNO = a.EMPNO
JOIN PROJECT p ON a.PNO = p.PNO;

select m.ename,count(*) from employee e,employee m where e.mgr_no=m.empno group by m.ename having count(*)=
(select max(mycount) from (select count(*) mycount from employee group by mgr_no)a);
